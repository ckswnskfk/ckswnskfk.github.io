---
title: "[F-Lab 모각코 챌린지] 30일차"
excerpt: "토큰"
categories:
  - Javascript
tags:
  - f-lab
  - 에프랩
  - TIL
  - Javascript
  - Browser
  - Token
last_modified_at: 2023-06-18
toc: true
---

쿠키와 웹 스토리지에 대해 개략적으로 알아봤으니, 이번엔 토큰에 대해 알아보자. 일반적으로 쿠키나 세션 등과 함께 비교되는 토큰은 JWT(JSON Web Token)를 말한다. 또한 모두 사용자 인증이나 인가를 위한 방법으로 소개되며, 셋은 각각 비교돼야 하는 대상이라기보단 하는 역할이 다르다고 이해해야 한다. 어찌됐든 오늘은 토큰 대해 개략적으로나마 알아보자.

# 토큰?

JWT(JavaScript Web Token)는 웹 애플리케이션에서 사용자 인증과 관련된 정보를 안전하게 전달하기 위해 개발된 토큰 기반 인증 방법인데, JWT 기반 인증 방식이 왜 탄생했는지를 먼저 이해하면 좋을 것 같다.

## 왜 만들어진겨

### 세션 기반 인증(서버 기반 인증)

이전에는 세션(Session) 기반 인증 방식이 주로 사용되었다. 세션 기반 인증은 서버 측에서 사용자의 인증 상태를 유지하기 위해 세션 ID를 생성하고, 이를 쿠키 등을 통해 클라이언트에게 전달하고, 매 요청마다 요청 헤더에 담겨 오는 세션 ID와 서버에 유지되는 로그인 정보를 비교하는 방식이다.

![서버 기반 인증](https://velopert.com/wp-content/uploads/2016/12/bb-450x469.png)

하지만 세션 기반 인증은 모든 로그인 정보를 유지해야 하기 때문에 서버 자원을 많이 사용하게 되고, 분산 환경에서는 중앙 집중식 세션 저장소를 사용해야 하는 등 추가적인 고민과 자원이 필요했다. 또 세션을 관리할 때 사용하는 쿠키는 단일 도메인 및 서브 도메인에서만 작동하도록 되어있다. 따라서 CORS(Cross-Origin Resource Sharing) 이슈가 있고, 이것을 관리하는 것은 번거롭다.

이러한 한계점을 극복하기 위해 JWT와 같은 토큰 기반 인증 방식이 등장하게 되었다. JWT는 토큰 자체에 인증 정보를 포함하고 있어 서버의 상태를 유지할 필요가 없다.

### 토큰 기반 인증

우선은 토큰 기반 인증의 과정을 개략적으로 알아보자.

1. 로그인: 사용자가 인증 정보(ID, 비밀번호 등)로 로그인한다.

2. 서버 인증: 서버는 사용자가 제공한 인증 정보가 올바른, 사용자를 식별할 수 있는 정보를 포함한 토큰을 생성한다.

3. 토큰 발급: 서버는 토큰을 생성하여 클라이언트에게 전달한다. 이 토큰에는 인증된 사용자의 정보와 추가적인 메타데이터가 포함된다. 문자열이기에 어디에든(URL, Header)담길수 있다. 전달된 이후 일반적으로는 클라이언트의 로컬 저장소(localStorage. 쿠키에 저장할 수도 있긴 함)에 저장된다.

4. 토큰 전달: 클라이언트는 서버에 요청을 보낼 때마다 토큰을 포함시켜 전달한다. 일반적으로는 HTTP 요청의 헤더(Authorization 헤더)에 "Bearer" 스킴을 사용하여 토큰을 전달한다.

5. 토큰 검증: 서버는 요청을 수신할 때마다 토큰을 검증한다. 검증은 토큰의 유효성, 무결성, 서명 등을 확인하는 과정이다. 유효한 토큰인 경우, 서버는 해당 요청을 처리하고 클라이언트에게 응답을 반환한다.

6. 인가: 서버는 토큰 내에 포함된 정보를 확인하여 클라이언트의 요청에 대한 인가를 수행한다. 토큰에는 사용자의 역할, 권한 또는 기타 필요한 정보가 포함될 수 있으며, 서버는 해당 정보를 기반으로 요청을 승인하거나 거부할 수 있다.

7. 로그아웃 또는 토큰 갱신: 사용자가 로그아웃을 요청하거나 토큰의 유효 기간이 만료되면, 클라이언트는 토큰을 폐기하고 더 이상 사용하지 않는다. 토큰의 유효 기간이 만료되기 전에 새로운 토큰을 발급받기 위해 클라이언트는 서버에 요청을 보낼 수도 있다.

![토큰 기반 인증](https://velopert.com/wp-content/uploads/2016/12/token-diagram-450x412.png)

### JWT의 생김새

토큰에는 어떤 정보가 담겨 있어야 서버에서 인증 정보를 보관하지 않고 로그인 등의 기능을 구현할 수 있을까?

#### Header

헤더는 두 가지 정보를 지닌다.

1. typ: 토큰의 타입을 지정한다. 바로 `JWT`!
2. alg: 해싱 알고리즘을 지정한다. `HMAC SHA256` 혹은 `RSA` 가 사용되며, 이 알고리즘은, 토큰을 검증 할 때 사용되는 signature 부분에서 사용된다.

#### Payload

여기에 실제 정보가 담기게 된다. 정보는 name:value 형태의 문자열로 담기게 되는데, 정보 한 조각(쌍)을 클레임이라 부른다.

##### 등록된 (registered) 클레임

토큰의 사용을 위해 정의된 표준 클레임이다. 예를 들어, "iss" (발급자), "exp" (만료 시간), "sub" (주제) 등이 있다. 이러한 등록된 클레임들은 일반적으로 토큰의 사용과 관련된 기본 정보를 나타낸다.

##### 공개 (public) 클레임

사용자가 정의하는 클레임으로, 토큰에 추가적인 정보를 포함시키기 위해 사용된다. 예를 들어 사용자의 이름, 이메일, 역할 등을 포함할 수 있다. 공개 클레임은 충돌을 방지하기 위해 이름이 URI 형식을 따라야 하지만, 일반적으로 사용자 정의 네임스페이스로 시작한다.

##### 비공개 (private) 클레임

토큰의 발급자와 수신자 사이에서 협의된 클레임으로, 애플리케이션 또는 서비스에 특정한 정보를 전달하기 위해 사용된다. 비공개 클레임은 클라이언트와 서버 간에만 의미가 있으며, 토큰의 발급자와 수신자가 이해할 수 있는 내용을 포함할 수 있다.

#### Signature

서명은 헤더의 인코딩값과, 정보의 인코딩값을 합친 후 주어진 비밀키로 해쉬를 하여 생성한다.

\*참고: <https://velopert.com/2350>,  
<https://velopert.com/2389>,  
<https://meetup.nhncloud.com/posts/239>,  
<https://chat.openai.com>
